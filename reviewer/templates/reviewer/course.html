{% extends 'reviewer/base.html' %}


{% block title %}
	{{ course_filt.name }}
{% endblock %}

{% block content %}
	<div class="container pt-5">
		<div class="my-5">
			<div class="m-auto d-flex flex-column align-items-start">
				<div class="w-100">
					<div class="mx-3">
						<div class="d-flex justify-content-between flex-column flex-lg-row mb-3 mb-lg-0">
							<div class="mx-auto mx-lg-0 text-center text-lg-left">
								<h1 class="h1 title" ><strong>{{ course_filt.code }} <span class="import-font-primary">{{ course_filt.number }}</span></strong></h1>
								<h4 class=" h4 mt-2">{{ course_filt.title }}</h4>
							</div>
							<div class="mx-auto mx-lg-0  text-center text-lg-right">
								<div>
									<small class="d-flex">
										<i class="material-icons material-icon-sm mx-2">update</i> Last Updated: {{ course_filt.lastupdated }}
									</small>
									{% if course_filt.old_curr == True %}
										<small class="d-inline-flex">
											<i class="material-icons material-icon-sm mx-2">error_outline</i>
											This is part of the old curriculum.
										</small>
									{% endif %}
								</div>
							</div>
						</div>
						<div class="mt-1">
							<p>{{course_filt.description}}</p>
							<small>
								<div class="mb-1">
									<span>Prerequisites:</span>
									<div class="d-inline-flex align-items-start">
										{% if course_filt.prereqs.count > 0 %}
											{% for prereq in course_filt.prereqs.all %}
												{% if forloop.counter != 1 %},{%endif%}
												<a href="{% url 'course' prereq.code|lower prereq.number %}">
													{{ prereq.name }}
												</a>
											{% endfor %}
										{% else %}
											None
										{% endif %}
									</div>
								</div>
								<div>
									<span>Corequisites:</span>
									<div class="d-inline-flex align-items-start">
										{% if course_filt.coreqs.count > 0 %}
											{% for coreq in course_filt.coreqs.all %}
												{% if forloop.counter != 1 %},{%endif%}
												<a href="{% url 'course' coreq.code|lower coreq.number %}">
													{{ coreq.name }}
												</a>
											{% endfor %}
										{% else %}
											None
										{% endif %}
									</div>
								</div>
							</small>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="">
			<ul class="nav nav-tabs" id="myTab" role="tablist">
			  <li class="nav-item">
			    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Lessons</a>
			  </li>
			  <li class="nav-item">
			    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Comments</a>
			  </li>
			  <li class="nav-item">
			    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">References</a>
			  </li>
			</ul>
			<div class="tab-content" id="myTabContent">
			  <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">...</div>
			  <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">

			  		<div class="row mx-0 py-5">
			  			<div class="col-lg-4">

			  				{% if user.is_anonymous %}
			  					<p>You must be logged in to comment.</p>
			  				{% endif %}
					  		<form class="form-group" enctype="multipart/form-data" method="POST" action="{% url 'course' course_filt.code|lower course_filt.number %}" >
								{% csrf_token %}

								{{ comment_form.body }}

								<div class="my-3">
									{{ comment_form.image }}
								</div>

								<input class="btn btn-primary" type="submit" value="Submit">
							</form>
						</div>
						<div class="col-lg-8">
							{% if course_comments.count == 0 %}
								<p class="d-inline-flex">
									<i class="material-icons my-auto">comment</i>
									<span class="my-auto mx-3">
										{% if user.is_authenticated %}
											Be the first to comment!
										{% else %}
											There are no comments to display.
										{% endif %}
									</span>
								</p>
							{% else %}
						  		{% for comment in course_comments %}
									<div class="py-4 px-4 d-flex mb-3" style="background-color: white">
										<img class="user-pic-thumb" src="{{comment.user_attr.prof_pic.url}}">
										<div class="ml-4 w-100">
											<div class="d-flex w-100 justify-content-between my-2">
												<span class="my-auto">
													<strong>{{comment.user_attr.username}}</strong> 
												</span>
												<p class="my-auto">
													<small class="d-inline-flex">
														<span class="mr-3 my-auto">
															{% if user.is_authenticated %}
																<i class="material-icons material-icon-sm mx-2">reply</i>
															{% endif %}
															{% if user == comment.user_attr %}
																<i class="material-icons  material-icon-sm">delete</i>
															{% endif %}
														</span>
														{{comment.date_posted}}
													</small>
												</p>
											</div>
											<p>{{comment.body}}</p>
											{% if comment.image %}
												<img class="mt-3 d-block comment-image" src="{{comment.image.url}}">
											{% endif %}
										
										</div>
									</div>
								{% endfor %}
							{% endif %}
						</div>
					</div>
			  </div>
			  <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">...</div>
			</div>
		</div>
	</div>
{% endblock %}